# 코드 분석 및 개선 보고서

## 개요
프로젝트 전반을 검토하며 즉시 개선이 필요한 부분을 정리했습니다. 각 항목은 위치, 영향, 우선순위를 한눈에 비교할 수 있도록 표로 구성했습니다.

## 주요 발견 사항
| 영역 | 문제 | 영향 | 개선 제안 |
| --- | --- | --- | --- |
| 영상 캡처 스레드의 종료 처리 | `stop_recording`가 프레임 버퍼 플러시, 파일 작성, ffmpeg 재인코딩, 업로드까지 단일 스레드에서 수행하여 카메라 캡처 루프가 장시간 중단됩니다. | 충돌 직후 추가 프레임이 누락되고, 두 카메라 모두 응답이 느려질 수 있습니다. | 녹화 종료 이후 I/O(파일 쓰기·재인코딩·업로드)를 워커 스레드나 작업 큐로 분리하고, 캡처 스레드는 프레임 수집에만 집중하도록 변경합니다. |
| 프레임 버퍼 락 공유 | 각 `VideoCaptureThread` 인스턴스가 별도 버퍼를 가지는데도 동일한 `frame_buffer_lock`을 공유합니다. | 서로 독립적인 버퍼 접근이 불필요하게 직렬화되어 두 카메라의 프레임이 동시에 추가될 때 병목·프레임 드롭 가능성이 커집니다. | 스레드마다 전용 락을 사용하거나 버퍼 접근에 락이 불필요한지 검토 후 제거합니다. |
| 센서 스크립트의 즉시 실행 | `Sensor.py`는 모듈 임포트 시 무한 루프가 바로 실행되어 테스트·재사용이 어렵고, 예외 발생 시 GPIO 정리가 보장되지 않습니다. | 다른 모듈에서 임포트만 해도 프로그램이 멈추며, 리소스 해제 실패로 하드웨어 상태가 불안정해질 수 있습니다. | `if __name__ == "__main__":` 블록에서만 루프를 실행하고, 함수화하여 호출자가 명확히 제어할 수 있도록 구조화합니다. |

